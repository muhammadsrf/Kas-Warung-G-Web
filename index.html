<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kas Warung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 300px; max-height: 40vh; }
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex; justify-content: center; align-items: center;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="flex h-screen bg-slate-100">
        <aside class="w-20 lg:w-64 bg-white shadow-md flex flex-col items-center lg:items-start p-4 transition-all duration-300">
            <div class="flex items-center justify-center lg:justify-start w-full mb-10">
                 <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">W</div>
                 <h1 class="text-xl font-bold ml-3 hidden lg:block">Kas Warung</h1>
            </div>
            <nav class="flex flex-col space-y-2 w-full">
                <a href="#dashboard" class="nav-link active flex items-center p-3 rounded-lg text-slate-700 bg-blue-100 font-semibold" data-target="dashboard">
                    <span class="text-xl">üìä</span><span class="ml-4 hidden lg:block">Dashboard</span>
                </a>
                <a href="#kasir" class="nav-link flex items-center p-3 rounded-lg text-slate-700 hover:bg-blue-50" data-target="kasir">
                    <span class="text-xl">üõí</span><span class="ml-4 hidden lg:block">Kasir</span>
                </a>
                <a href="#produk" class="nav-link flex items-center p-3 rounded-lg text-slate-700 hover:bg-blue-50" data-target="produk">
                    <span class="text-xl">üì¶</span><span class="ml-4 hidden lg:block">Produk</span>
                </a>
                <a href="#laporan" class="nav-link flex items-center p-3 rounded-lg text-slate-700 hover:bg-blue-50" data-target="laporan">
                    <span class="text-xl">üìà</span><span class="ml-4 hidden lg:block">Laporan</span>
                </a>
                <a href="#pengaturan" class="nav-link flex items-center p-3 rounded-lg text-slate-700 hover:bg-blue-50" data-target="pengaturan">
                    <span class="text-xl">‚öôÔ∏è</span><span class="ml-4 hidden lg:block">Pengaturan</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
            
            <section id="dashboard" class="page-content active">
                <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-sm font-medium text-slate-500">Penjualan Hari Ini</h3>
                        <p class="text-3xl font-bold text-blue-600 mt-2">Rp 1.250.000</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-sm font-medium text-slate-500">Transaksi Hari Ini</h3>
                        <p class="text-3xl font-bold text-emerald-600 mt-2">82</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-sm font-medium text-slate-500">Produk Terlaris</h3>
                        <p class="text-3xl font-bold mt-2">Kopi Instan</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-sm font-medium text-slate-500">Stok Kritis</h3>
                        <p class="text-3xl font-bold text-amber-600 mt-2">5 Produk</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <h3 class="text-lg font-semibold mb-4">Tren Penjualan 7 Hari Terakhir</h3>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow">
                         <h3 class="text-lg font-semibold mb-4">Stok Segera Habis</h3>
                         <ul class="space-y-3">
                             <li class="flex justify-between items-center"><span>Gula Pasir 1kg</span><span class="font-bold text-red-500">3 pcs</span></li>
                             <li class="flex justify-between items-center"><span>Minyak Goreng 2L</span><span class="font-bold text-red-500">2 pcs</span></li>
                             <li class="flex justify-between items-center"><span>Telur Ayam</span><span class="font-bold text-amber-500">12 pcs</span></li>
                             <li class="flex justify-between items-center"><span>Mie Instan Original</span><span class="font-bold text-amber-500">15 pcs</span></li>
                         </ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                         <h3 class="text-lg font-semibold mb-4">Transaksi Terakhir</h3>
                         <ul class="space-y-3">
                             <li class="flex justify-between items-center"><span>INV/20250601/082</span><span class="font-semibold text-emerald-600">Rp 25.000</span></li>
                             <li class="flex justify-between items-center"><span>INV/20250601/081</span><span class="font-semibold text-emerald-600">Rp 12.500</span></li>
                             <li class="flex justify-between items-center"><span>INV/20250601/080</span><span class="font-semibold text-emerald-600">Rp 78.000</span></li>
                             <li class="flex justify-between items-center"><span>INV/20250601/079</span><span class="font-semibold text-emerald-600">Rp 5.000</span></li>
                         </ul>
                    </div>
                </div>
            </section>

            <section id="kasir" class="page-content hidden">
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow p-6 h-[85vh] flex flex-col">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <input id="searchInput" type="text" placeholder="Cari produk..." class="w-full sm:w-1/2 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="categoryFilter" class="w-full sm:w-1/2 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="all">Semua Kategori</option>
                                <option value="Minuman">Minuman</option>
                                <option value="Makanan Ringan">Makanan Ringan</option>
                                <option value="Sembako">Sembako</option>
                                <option value="Bumbu Dapur">Bumbu Dapur</option>
                            </select>
                        </div>
                        <div id="productList" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 overflow-y-auto flex-1 p-2">
                        </div>
                    </div>
                    <div class="lg:col-span-1 bg-white rounded-xl shadow p-6 h-[85vh] flex flex-col">
                        <h3 class="text-xl font-bold mb-4">Keranjang</h3>
                        <div id="cartItems" class="flex-1 overflow-y-auto border-y py-4 space-y-3">
                            <p class="text-slate-400 text-center">Keranjang masih kosong.</p>
                        </div>
                        <div class="mt-4 pt-4 border-t">
                            <div class="flex justify-between text-lg font-semibold mb-4">
                                <span>Total</span>
                                <span id="cartTotal">Rp 0</span>
                            </div>
                            <button id="payButton" class="w-full bg-blue-600 text-white p-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition disabled:bg-slate-300">
                                Bayar
                            </button>
                        </div>
                    </div>
                 </div>
            </section>

            <section id="produk" class="page-content hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Manajemen Produk</h2>
                    <button id="addProductBtn" class="bg-blue-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-blue-700 transition">Tambah Produk</button>
                </div>
                <div class="bg-white rounded-xl shadow overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-4 font-semibold">Nama Produk</th>
                                <th class="p-4 font-semibold">Kategori</th>
                                <th class="p-4 font-semibold">Harga Jual</th>
                                <th class="p-4 font-semibold">Stok</th>
                                <th class="p-4 font-semibold">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="laporan" class="page-content hidden">
                <h2 class="text-2xl font-bold mb-6">Laporan Penjualan</h2>
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <div class="flex items-center gap-4 mb-4">
                        <label for="reportPeriod" class="font-medium">Periode:</label>
                        <select id="reportPeriod" class="p-2 border rounded-lg">
                            <option value="daily">Harian</option>
                            <option value="weekly">Mingguan</option>
                            <option value="monthly">Bulanan</option>
                        </select>
                    </div>
                     <div class="chart-container" style="height: 350px;">
                        <canvas id="salesReportChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="pengaturan" class="page-content hidden">
                <h2 class="text-2xl font-bold mb-6">Pengaturan</h2>
                <div class="bg-white p-8 rounded-xl shadow max-w-2xl mx-auto">
                    <h3 class="text-lg font-semibold mb-6">Informasi Warung</h3>
                    <form class="space-y-6">
                        <div>
                            <label for="shopName" class="block text-sm font-medium text-slate-700 mb-1">Nama Warung</label>
                            <input type="text" id="shopName" value="Warung Sejahtera" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                         <div>
                            <label for="shopAddress" class="block text-sm font-medium text-slate-700 mb-1">Alamat</label>
                            <input type="text" id="shopAddress" value="Jl. Merdeka No. 17, Jakarta" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                         <div>
                            <label for="shopPhone" class="block text-sm font-medium text-slate-700 mb-1">No. Telepon</label>
                            <input type="text" id="shopPhone" value="081234567890" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="pt-4">
                            <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition">Simpan Perubahan</button>
                        </div>
                    </form>
                </div>
            </section>

        </main>
    </div>

    <div id="paymentModal" class="modal-backdrop hidden">
        <div class="bg-white w-full max-w-md p-8 rounded-xl shadow-lg m-4">
            <h2 class="text-2xl font-bold text-center mb-6">Pembayaran</h2>
            <div class="mb-4">
                <p class="text-lg text-slate-600">Total Tagihan</p>
                <p id="modalTotal" class="text-4xl font-bold text-blue-600">Rp 0</p>
            </div>
            <div class="mb-4">
                <label for="amountPaid" class="block text-sm font-medium text-slate-700 mb-1">Uang Tunai</label>
                <input type="number" id="amountPaid" placeholder="Masukkan jumlah uang" class="w-full p-4 border-2 rounded-lg text-2xl focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="mb-6">
                <p class="text-lg text-slate-600">Kembalian</p>
                <p id="changeAmount" class="text-4xl font-bold text-emerald-600">Rp 0</p>
            </div>
            <div class="flex gap-4">
                <button id="closeModalBtn" class="w-full bg-slate-200 text-slate-800 p-3 rounded-lg font-bold hover:bg-slate-300 transition">Tutup</button>
                <button id="completeTransactionBtn" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition disabled:bg-slate-300">Selesaikan Transaksi</button>
            </div>
        </div>
    </div>
    
    <div id="productModal" class="modal-backdrop hidden">
        <div class="bg-white w-full max-w-lg p-8 rounded-xl shadow-lg m-4">
            <h2 id="productModalTitle" class="text-2xl font-bold mb-6">Tambah Produk Baru</h2>
            <form id="productForm" class="space-y-4">
                <input type="hidden" id="productId">
                <div>
                    <label for="productName" class="block text-sm font-medium text-slate-700 mb-1">Nama Produk</label>
                    <input type="text" id="productName" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label for="productCategory" class="block text-sm font-medium text-slate-700 mb-1">Kategori</label>
                    <select id="productCategory" class="w-full p-3 border rounded-lg" required>
                        <option value="Minuman">Minuman</option>
                        <option value="Makanan Ringan">Makanan Ringan</option>
                        <option value="Sembako">Sembako</option>
                        <option value="Bumbu Dapur">Bumbu Dapur</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                 <div>
                    <label for="productPrice" class="block text-sm font-medium text-slate-700 mb-1">Harga Jual (Rp)</label>
                    <input type="number" id="productPrice" class="w-full p-3 border rounded-lg" required>
                </div>
                 <div>
                    <label for="productStock" class="block text-sm font-medium text-slate-700 mb-1">Stok Awal</label>
                    <input type="number" id="productStock" class="w-full p-3 border rounded-lg" required>
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" id="closeProductModalBtn" class="w-full bg-slate-200 text-slate-800 p-3 rounded-lg font-bold hover:bg-slate-300 transition">Batal</button>
                    <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition">Simpan Produk</button>
                </div>
            </form>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const formatRupiah = (number) => {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
    }

    const mockProducts = [
        { id: 1, name: 'Kopi Instan', category: 'Minuman', price: 1500, stock: 100, image: '‚òï' },
        { id: 2, name: 'Teh Celup', category: 'Minuman', price: 500, stock: 150, image: 'üçµ' },
        { id: 3, name: 'Air Mineral 600ml', category: 'Minuman', price: 3000, stock: 80, image: 'üíß' },
        { id: 4, name: 'Keripik Singkong', category: 'Makanan Ringan', price: 5000, stock: 50, image: 'ü•î' },
        { id: 5, name: 'Biskuit Coklat', category: 'Makanan Ringan', price: 7500, stock: 60, image: 'üç™' },
        { id: 6, name: 'Beras 5kg', category: 'Sembako', price: 65000, stock: 30, image: 'üçö' },
        { id: 7, name: 'Minyak Goreng 2L', category: 'Sembako', price: 32000, stock: 2, image: 'üõ¢Ô∏è' },
        { id: 8, name: 'Gula Pasir 1kg', category: 'Sembako', price: 14000, stock: 3, image: 'üç¨' },
        { id: 9, name: 'Garam Meja', category: 'Bumbu Dapur', price: 2000, stock: 70, image: 'üßÇ' },
        { id: 10, name: 'Mie Instan Original', category: 'Sembako', price: 3000, stock: 200, image: 'üçú' },
        { id: 11, name: 'Saus Sambal', category: 'Bumbu Dapur', price: 6000, stock: 40, image: 'üå∂Ô∏è' },
        { id: 12, name: 'Telur Ayam', category: 'Sembako', price: 2500, stock: 12, image: 'ü•ö' },
    ];

    let cart = [];
    
    const navLinks = document.querySelectorAll('.nav-link');
    const pageContents = document.querySelectorAll('.page-content');
    const productList = document.getElementById('productList');
    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const payButton = document.getElementById('payButton');
    const paymentModal = document.getElementById('paymentModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const amountPaidInput = document.getElementById('amountPaid');
    const changeAmountEl = document.getElementById('changeAmount');
    const modalTotalEl = document.getElementById('modalTotal');
    const completeTransactionBtn = document.getElementById('completeTransactionBtn');
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const productTableBody = document.getElementById('productTableBody');
    const addProductBtn = document.getElementById('addProductBtn');
    const productModal = document.getElementById('productModal');
    const closeProductModalBtn = document.getElementById('closeProductModalBtn');
    const productForm = document.getElementById('productForm');
    const productModalTitle = document.getElementById('productModalTitle');

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const target = link.getAttribute('data-target');

            navLinks.forEach(l => {
                l.classList.remove('active', 'bg-blue-100', 'font-semibold');
                l.classList.add('hover:bg-blue-50');
            });
            link.classList.add('active', 'bg-blue-100', 'font-semibold');
            link.classList.remove('hover:bg-blue-50');

            pageContents.forEach(page => {
                page.classList.add('hidden');
                if (page.id === target) {
                    page.classList.remove('hidden');
                }
            });
        });
    });

    const renderProducts = (filter = '', category = 'all') => {
        productList.innerHTML = '';
        const filteredProducts = mockProducts.filter(p => {
            const nameMatch = p.name.toLowerCase().includes(filter.toLowerCase());
            const categoryMatch = category === 'all' || p.category === category;
            return nameMatch && categoryMatch;
        });

        if(filteredProducts.length === 0) {
            productList.innerHTML = '<p class="text-slate-400 col-span-full text-center">Produk tidak ditemukan.</p>';
            return;
        }

        filteredProducts.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'bg-slate-50 border rounded-lg p-3 flex flex-col items-center text-center cursor-pointer hover:shadow-lg hover:border-blue-500 transition';
            productCard.innerHTML = `
                <div class="text-4xl mb-2">${product.image}</div>
                <h4 class="font-semibold text-sm h-10 flex items-center">${product.name}</h4>
                <p class="text-blue-600 font-bold mt-1">${formatRupiah(product.price)}</p>
            `;
            productCard.addEventListener('click', () => addToCart(product.id));
            productList.appendChild(productCard);
        });
    };
    
    const renderProductTable = () => {
        productTableBody.innerHTML = '';
        mockProducts.forEach(p => {
            const row = document.createElement('tr');
            row.className = 'border-b';
            row.innerHTML = `
                <td class="p-4">${p.name}</td>
                <td class="p-4">${p.category}</td>
                <td class="p-4">${formatRupiah(p.price)}</td>
                <td class="p-4">${p.stock}</td>
                <td class="p-4">
                    <button class="text-blue-600 hover:underline mr-2" data-id="${p.id}" onclick="window.app.editProduct(event)">Edit</button>
                    <button class="text-red-600 hover:underline" data-id="${p.id}" onclick="window.app.deleteProduct(event)">Hapus</button>
                </td>
            `;
            productTableBody.appendChild(row);
        });
    };

    const addToCart = (productId) => {
        const product = mockProducts.find(p => p.id === productId);
        const cartItem = cart.find(item => item.id === productId);

        if (cartItem) {
            cartItem.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        renderCart();
    };
    
    const renderCart = () => {
        cartItemsEl.innerHTML = '';
        if (cart.length === 0) {
            cartItemsEl.innerHTML = '<p class="text-slate-400 text-center">Keranjang masih kosong.</p>';
            payButton.disabled = true;
        } else {
            cart.forEach(item => {
                const cartItemEl = document.createElement('div');
                cartItemEl.className = 'flex items-center justify-between';
                cartItemEl.innerHTML = `
                    <div>
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-slate-500">${formatRupiah(item.price)}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="w-7 h-7 bg-slate-200 rounded-full font-bold" onclick="window.app.updateQuantity(${item.id}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="w-7 h-7 bg-slate-200 rounded-full font-bold" onclick="window.app.updateQuantity(${item.id}, 1)">+</button>
                    </div>
                `;
                cartItemsEl.appendChild(cartItemEl);
            });
            payButton.disabled = false;
        }
        updateCartTotal();
    };

    window.app = {
        updateQuantity: (productId, change) => {
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity += change;
                if (cartItem.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
            }
            renderCart();
        },
        editProduct: (event) => {
            const productId = parseInt(event.target.dataset.id);
            const product = mockProducts.find(p => p.id === productId);
            if(product){
                productModalTitle.innerText = "Edit Produk";
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                productModal.classList.remove('hidden');
            }
        },
        deleteProduct: (event) => {
            const productId = parseInt(event.target.dataset.id);
            const confirmed = true; // Bypassing confirm() for this environment
            if(confirmed){
                const index = mockProducts.findIndex(p => p.id === productId);
                if(index > -1){
                    mockProducts.splice(index, 1);
                    renderProductTable();
                    renderProducts();
                }
            }
        }
    };
    
    const updateCartTotal = () => {
        const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        cartTotalEl.innerText = formatRupiah(total);
        return total;
    };

    payButton.addEventListener('click', () => {
        const total = updateCartTotal();
        modalTotalEl.innerText = formatRupiah(total);
        amountPaidInput.value = '';
        changeAmountEl.innerText = formatRupiah(0);
        completeTransactionBtn.disabled = true;
        paymentModal.classList.remove('hidden');
        amountPaidInput.focus();
    });

    closeModalBtn.addEventListener('click', () => {
        paymentModal.classList.add('hidden');
    });
    
    amountPaidInput.addEventListener('input', () => {
        const total = updateCartTotal();
        const paid = parseFloat(amountPaidInput.value) || 0;
        const change = paid - total;
        changeAmountEl.innerText = formatRupiah(change >= 0 ? change : 0);
        completeTransactionBtn.disabled = change < 0;
    });

    completeTransactionBtn.addEventListener('click', () => {
        cart.forEach(cartItem => {
            const product = mockProducts.find(p => p.id === cartItem.id);
            if(product) {
                product.stock -= cartItem.quantity;
            }
        });
        cart = [];
        renderCart();
        renderProducts();
        renderProductTable();
        paymentModal.classList.add('hidden');
    });

    searchInput.addEventListener('input', (e) => renderProducts(e.target.value, categoryFilter.value));
    categoryFilter.addEventListener('change', (e) => renderProducts(searchInput.value, e.target.value));

    addProductBtn.addEventListener('click', () => {
        productModalTitle.innerText = 'Tambah Produk Baru';
        productForm.reset();
        document.getElementById('productId').value = '';
        productModal.classList.remove('hidden');
    });

    closeProductModalBtn.addEventListener('click', () => {
        productModal.classList.add('hidden');
    });
    
    productForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('productId').value;
        const newProduct = {
            id: id ? parseInt(id) : Date.now(),
            name: document.getElementById('productName').value,
            category: document.getElementById('productCategory').value,
            price: parseFloat(document.getElementById('productPrice').value),
            stock: parseInt(document.getElementById('productStock').value),
            image: 'üÜï'
        };

        if(id) {
            const index = mockProducts.findIndex(p => p.id === newProduct.id);
            if(index > -1) mockProducts[index] = newProduct;
        } else {
            mockProducts.unshift(newProduct);
        }
        
        productModal.classList.add('hidden');
        renderProductTable();
        renderProducts();
    });
    
    const salesTrendCtx = document.getElementById('salesTrendChart').getContext('2d');
    new Chart(salesTrendCtx, {
        type: 'line',
        data: {
            labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
            datasets: [{
                label: 'Penjualan',
                data: [300000, 550000, 450000, 780000, 650000, 950000, 1250000],
                borderColor: 'rgb(37, 99, 235)',
                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, ticks: { callback: value => formatRupiah(value) } }
            },
            plugins: {
                tooltip: { callbacks: { label: context => formatRupiah(context.raw) } }
            }
        }
    });

    const salesReportCtx = document.getElementById('salesReportChart').getContext('2d');
    new Chart(salesReportCtx, {
        type: 'bar',
        data: {
            labels: ['Makanan Ringan', 'Minuman', 'Sembako', 'Bumbu Dapur'],
            datasets: [{
                label: 'Total Penjualan',
                data: [450000, 320000, 1500000, 120000],
                backgroundColor: ['#3b82f6', '#10b981', '#f97316', '#eab308'],
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, ticks: { callback: value => formatRupiah(value) } }
            },
            plugins: {
                legend: { display: false },
                tooltip: { callbacks: { label: context => formatRupiah(context.raw) } }
            }
        }
    });
    
    renderProducts();
    renderCart();
    renderProductTable();
});
</script>

</body>
</html>
